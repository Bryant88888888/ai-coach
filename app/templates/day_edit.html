{% extends "base.html" %}

{% block title %}{% if is_new %}新增課程{% else %}編輯 Day {{ day.day }}{% endif %} - 寶格教育訓練{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center gap-4">
        <a href="/dashboard/days?version={{ current_version }}" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg min-h-[44px] min-w-[44px] flex items-center justify-center">
            <i class="fas fa-arrow-left text-gray-600 dark:text-gray-400"></i>
        </a>
        <div>
            <h1 class="text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white">
                {% if is_new %}
                新增訓練日
                {% else %}
                編輯 Day {{ day.day }} - {{ day.title }}
                {% endif %}
            </h1>
            <p class="text-gray-600 dark:text-gray-400 mt-1">
                {% if is_new %}在 {{ current_version }} 版本中新增訓練日{% else %}修改訓練內容{% endif %}
                <span class="text-indigo-600 dark:text-indigo-400">（版本：{{ current_version }}）</span>
            </p>
        </div>
    </div>
</div>

{% if success %}
<div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded-lg mb-6 flex items-center">
    <i class="fas fa-check-circle mr-2"></i>
    儲存成功！
</div>
{% endif %}

{% if error %}
<div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg mb-6 flex items-center">
    <i class="fas fa-exclamation-circle mr-2"></i>
    {{ error }}
</div>
{% endif %}

<form method="POST" action="{% if is_new %}/dashboard/days/create{% else %}/dashboard/days/{{ day.day }}/edit{% endif %}" class="space-y-6">
    <!-- 隱藏欄位 -->
    {% if not is_new %}
    <input type="hidden" name="course_id" value="{{ course_id }}">
    {% endif %}
    <input type="hidden" name="course_version" value="{{ current_version }}">

    <!-- 基本資訊 -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
            <i class="fas fa-info-circle mr-2 text-indigo-500"></i>基本資訊
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">訓練天數 (Day)</label>
                <input type="number" name="day" value="{{ day.day }}" min="0" max="99" required
                       {% if not is_new %}readonly{% endif %}
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[48px] {% if not is_new %}bg-gray-100 dark:bg-gray-600{% endif %}">
                {% if not is_new %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">天數建立後無法修改</p>
                {% endif %}
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">課程標題</label>
                <input type="text" name="title" value="{{ day.title }}" required
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[48px]">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">課程目標</label>
                <input type="text" name="goal" value="{{ day.goal or '' }}"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[48px]"
                       placeholder="例如：學會安全回話，不否定、不保證、不急著解釋">
            </div>
        </div>
    </div>

    <!-- 當日重點教學（顯示在卡片上） -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">
            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>當日重點教學
            <span class="text-sm font-normal text-gray-500 dark:text-gray-400">（選填）</span>
        </h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            這段內容會顯示在訓練卡片上，讓學員在開始測驗前先閱讀重點知識
        </p>
        <div>
            <textarea name="lesson_content" rows="8"
                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                      placeholder="例如：&#10;今天學習「安全回話三原則」：&#10;&#10;1. 不否定對方感受&#10;2. 不保證任何事情&#10;3. 不急著解釋">{{ day.lesson_content or '' }}</textarea>
        </div>
    </div>

    <!-- 測驗設定 -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">
            <i class="fas fa-comments mr-2 text-blue-500"></i>測驗設定
            <span class="text-sm font-normal text-gray-500 dark:text-gray-400">（選填，有填才會進行測驗）</span>
        </h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            設定 AI 扮演的角色開場白，學員需要回應並通過評分
        </p>

        <!-- 開場白設定 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    <span class="inline-flex items-center">
                        <i class="fas fa-user-circle mr-2 text-pink-500"></i>
                        Persona A（無經驗）開場白
                    </span>
                </label>
                <textarea name="opening_a" rows="4"
                          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                          placeholder="輸入無經驗新人的開場白...">{{ day.opening_a or '' }}</textarea>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    <span class="inline-flex items-center">
                        <i class="fas fa-user-circle mr-2 text-blue-500"></i>
                        Persona B（有經驗）開場白
                    </span>
                </label>
                <textarea name="opening_b" rows="4"
                          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                          placeholder="輸入有經驗新人的開場白...">{{ day.opening_b or '' }}</textarea>
            </div>
        </div>

        <!-- 評分標準 -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-list-check mr-2 text-green-500"></i>評分標準（每行一個）
            </label>
            <textarea name="criteria" rows="4"
                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 font-mono"
                      placeholder="不否定對方感受&#10;不保證任何事情&#10;不急著解釋">{% if day.criteria %}{% for c in day.criteria %}{{ c }}{% if not loop.last %}
{% endif %}{% endfor %}{% endif %}</textarea>
        </div>

        <!-- 輪數設定 -->
        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    <i class="fas fa-repeat mr-2 text-purple-500"></i>最少輪數
                </label>
                <input type="number" name="min_rounds" value="{{ day.min_rounds or 3 }}" min="1" max="20"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[48px]">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">最多輪數</label>
                <input type="number" name="max_rounds" value="{{ day.max_rounds or 5 }}" min="1" max="20"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[48px]">
            </div>
        </div>
    </div>

    <!-- 純教學內容（進階） -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">
            <i class="fas fa-book-open mr-2 text-orange-500"></i>純教學內容
            <span class="text-sm font-normal text-gray-500 dark:text-gray-400">（選填，進階設定）</span>
        </h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            如果這天是純教學日（不測驗），在這裡輸入完整教學內容。學員回覆任何訊息即自動通過。
        </p>
        <div>
            <textarea name="teaching_content" rows="10"
                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"
                      placeholder="輸入完整教學內容...">{{ day.teaching_content or '' }}</textarea>
        </div>
    </div>

    <!-- 操作按鈕 -->
    <div class="flex flex-col sm:flex-row gap-4">
        <button type="submit"
                class="flex-1 sm:flex-none px-6 py-3 bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 text-white font-semibold rounded-xl transition min-h-[48px] flex items-center justify-center">
            <i class="fas fa-save mr-2"></i>{% if is_new %}建立訓練日{% else %}儲存變更{% endif %}
        </button>
        <a href="/dashboard/days?version={{ current_version }}"
           class="flex-1 sm:flex-none px-6 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl transition min-h-[48px] flex items-center justify-center">
            <i class="fas fa-times mr-2"></i>取消
        </a>
    </div>
</form>
{% endblock %}
