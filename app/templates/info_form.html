<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>人事資料填寫 - 寶格教育訓練</title>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* 避免 iOS 輸入框放大 */
        input, textarea, select { font-size: 16px !important; }
        /* 平滑捲動 */
        html { scroll-behavior: smooth; }
        /* Tab active 底線動畫 */
        .tab-btn { position: relative; }
        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: rgb(79 70 229);
            transition: all 0.25s ease;
            transform: translateX(-50%);
        }
        .dark .tab-btn::after { background: rgb(129 140 248); }
        .tab-btn.active::after { width: 100%; left: 50%; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen">
    <!-- 頂部導航 -->
    <div class="bg-gradient-to-r from-indigo-600 to-indigo-700 dark:from-gray-800 dark:to-gray-900 text-white px-4 py-4 sticky top-0 z-10 shadow">
        <div class="flex items-center justify-between max-w-lg mx-auto">
            <h1 class="text-lg font-bold">
                <i class="fas fa-file-pen mr-2"></i>人事資料填寫
            </h1>
            <div id="user-info" class="flex items-center gap-2">
                <img id="user-avatar" src="" alt="" class="w-8 h-8 rounded-full hidden">
                <span id="user-name" class="text-sm"></span>
            </div>
        </div>
    </div>

    <div class="max-w-lg mx-auto p-4 pb-8">
        <!-- 載入中 -->
        <div id="loading-section" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 mb-4">
                <i class="fas fa-spinner fa-spin text-4xl text-indigo-600 dark:text-indigo-400"></i>
            </div>
            <p class="text-gray-600 dark:text-gray-400">正在載入...</p>
        </div>

        <!-- 主要內容 -->
        <div id="main-content" class="hidden space-y-4">
            <!-- 提醒區塊 -->
            <div id="warning-block" class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-2xl p-4">
                <div class="flex items-start gap-3">
                    <div class="bg-amber-100 dark:bg-amber-900/40 rounded-full p-2 mt-0.5 shrink-0">
                        <i class="fas fa-exclamation-triangle text-amber-600 dark:text-amber-400 text-sm"></i>
                    </div>
                    <div class="text-sm">
                        <p class="font-semibold text-amber-800 dark:text-amber-300 mb-1">填寫注意事項</p>
                        <ul class="space-y-1 text-amber-700 dark:text-amber-400">
                            <li>請仔細核對每一項資料，確認無誤再送出</li>
                            <li>姓名、身分證字號請特別留意，<b>避免打錯字</b></li>
                            <li>送出後如需修改請聯繫管理人員</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 類別切換 Tab -->
            <div id="tab-bar" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
                <div class="flex">
                    <button type="button" data-tab="pr"
                        class="tab-btn active flex-1 py-3 text-center text-sm font-semibold text-indigo-600 dark:text-indigo-400 min-h-[48px]">
                        公關版本
                    </button>
                    <button type="button" data-tab="agent"
                        class="tab-btn flex-1 py-3 text-center text-sm font-semibold text-gray-400 dark:text-gray-500 min-h-[48px]">
                        經紀人版本
                    </button>
                    <button type="button" data-tab="transfer"
                        class="tab-btn flex-1 py-3 text-center text-sm font-semibold text-gray-400 dark:text-gray-500 min-h-[48px]">
                        異動資料
                    </button>
                </div>
            </div>

            <!-- ===== 公關版本 ===== -->
            <form id="form-pr" class="tab-content bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-5 space-y-4" novalidate>
                <input type="hidden" name="form_type" value="公關版本">

                <!-- 啟用/停用 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">狀態 <span class="text-red-500">*</span></label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="啟用" checked class="hidden peer">
                            <div class="peer-checked:bg-green-50 peer-checked:border-green-500 peer-checked:text-green-700 dark:peer-checked:bg-green-900/20 dark:peer-checked:border-green-500 dark:peer-checked:text-green-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-check mr-1.5"></i>啟用
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="停用" class="hidden peer">
                            <div class="peer-checked:bg-red-50 peer-checked:border-red-500 peer-checked:text-red-700 dark:peer-checked:bg-red-900/20 dark:peer-checked:border-red-500 dark:peer-checked:text-red-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-xmark mr-1.5"></i>停用
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 職位 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">職位 <span class="text-red-500">*</span></label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="position" value="公關" checked class="hidden peer">
                            <div class="peer-checked:bg-indigo-50 peer-checked:border-indigo-500 peer-checked:text-indigo-700 dark:peer-checked:bg-indigo-900/20 dark:peer-checked:border-indigo-500 dark:peer-checked:text-indigo-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                公關
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="position" value="助理" class="hidden peer">
                            <div class="peer-checked:bg-indigo-50 peer-checked:border-indigo-500 peer-checked:text-indigo-700 dark:peer-checked:bg-indigo-900/20 dark:peer-checked:border-indigo-500 dark:peer-checked:text-indigo-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                助理
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">本名 <span class="text-red-500">*</span></label>
                    <input type="text" name="real_name" required maxlength="20" placeholder="請輸入真實姓名"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">身分證字號 <span class="text-red-500">*</span></label>
                    <input type="text" name="id_number" required maxlength="10" placeholder="例：A123456789" autocapitalize="characters"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px] uppercase tracking-wider">
                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">1 個英文字母 + 9 位數字，英文自動轉大寫</p>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">出生（民國） <span class="text-red-500">*</span></label>
                    <input type="text" name="birth_roc" required maxlength="9" placeholder="例：85/06/15" inputmode="numeric"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">格式：民國年/月/日</p>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">藝名 <span class="text-red-500">*</span></label>
                    <input type="text" name="stage_name" required maxlength="20" placeholder="請輸入藝名"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">經紀人 <span class="text-red-500">*</span></label>
                    <input type="text" name="manager" required maxlength="20" placeholder="請輸入經紀人姓名"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">店家 <span class="text-red-500">*</span></label>
                    <input type="text" name="store" required maxlength="30" placeholder="請輸入所屬店家名稱"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">狀況 <span class="text-red-500">*</span></label>
                    <input type="text" name="status" required maxlength="50" placeholder="請填寫目前狀況"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">備註 <span class="text-red-500">*</span></label>
                    <textarea name="note" required maxlength="200" rows="3" placeholder="請填寫備註事項"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition resize-none"></textarea>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">IG <span class="text-red-500">*</span></label>
                    <input type="text" name="ig" required maxlength="50" placeholder="例：@username"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Instagram 帳號</p>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div class="pt-3">
                    <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3.5 px-6 rounded-xl transition min-h-[52px] text-base shadow-lg active:scale-[0.98]">
                        確認送出
                    </button>
                </div>
            </form>

            <!-- ===== 經紀人版本 ===== -->
            <form id="form-agent" class="tab-content bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-5 space-y-4 hidden" novalidate>
                <input type="hidden" name="form_type" value="經紀人版本">

                <!-- 啟用/停用 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">狀態 <span class="text-red-500">*</span></label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="啟用" checked class="hidden peer">
                            <div class="peer-checked:bg-green-50 peer-checked:border-green-500 peer-checked:text-green-700 dark:peer-checked:bg-green-900/20 dark:peer-checked:border-green-500 dark:peer-checked:text-green-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-check mr-1.5"></i>啟用
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="停用" class="hidden peer">
                            <div class="peer-checked:bg-red-50 peer-checked:border-red-500 peer-checked:text-red-700 dark:peer-checked:bg-red-900/20 dark:peer-checked:border-red-500 dark:peer-checked:text-red-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-xmark mr-1.5"></i>停用
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 職位 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">職位 <span class="text-red-500">*</span></label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="position" value="經紀人" checked class="hidden peer">
                            <div class="peer-checked:bg-indigo-50 peer-checked:border-indigo-500 peer-checked:text-indigo-700 dark:peer-checked:bg-indigo-900/20 dark:peer-checked:border-indigo-500 dark:peer-checked:text-indigo-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                經紀人
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="position" value="助理" class="hidden peer">
                            <div class="peer-checked:bg-indigo-50 peer-checked:border-indigo-500 peer-checked:text-indigo-700 dark:peer-checked:bg-indigo-900/20 dark:peer-checked:border-indigo-500 dark:peer-checked:text-indigo-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                助理
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">本名 <span class="text-red-500">*</span></label>
                    <input type="text" name="real_name" required maxlength="20" placeholder="請輸入真實姓名"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">身分證字號 <span class="text-red-500">*</span></label>
                    <input type="text" name="id_number" required maxlength="10" placeholder="例：A123456789" autocapitalize="characters"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px] uppercase tracking-wider">
                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">1 個英文字母 + 9 位數字，英文自動轉大寫</p>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">出生（民國） <span class="text-red-500">*</span></label>
                    <input type="text" name="birth_roc" required maxlength="9" placeholder="例：85/06/15" inputmode="numeric"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">格式：民國年/月/日</p>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">暱稱 <span class="text-red-500">*</span></label>
                    <input type="text" name="nickname" required maxlength="20" placeholder="請輸入暱稱"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">職稱位階 <span class="text-red-500">*</span></label>
                    <input type="text" name="job_title" required maxlength="30" placeholder="請輸入職稱或位階"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">組長 <span class="text-red-500">*</span></label>
                    <input type="text" name="team_leader" required maxlength="20" placeholder="請輸入組長姓名"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">狀況 <span class="text-red-500">*</span></label>
                    <input type="text" name="status" required maxlength="50" placeholder="請填寫目前狀況"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">備註 <span class="text-red-500">*</span></label>
                    <textarea name="note" required maxlength="200" rows="3" placeholder="請填寫備註事項"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition resize-none"></textarea>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div class="pt-3">
                    <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3.5 px-6 rounded-xl transition min-h-[52px] text-base shadow-lg active:scale-[0.98]">
                        確認送出
                    </button>
                </div>
            </form>

            <!-- ===== 異動資料 ===== -->
            <form id="form-transfer" class="tab-content bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-5 space-y-4 hidden" novalidate>
                <input type="hidden" name="form_type" value="異動資料">

                <!-- 啟用/停用 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">狀態 <span class="text-red-500">*</span></label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="啟用" checked class="hidden peer">
                            <div class="peer-checked:bg-green-50 peer-checked:border-green-500 peer-checked:text-green-700 dark:peer-checked:bg-green-900/20 dark:peer-checked:border-green-500 dark:peer-checked:text-green-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-check mr-1.5"></i>啟用
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="active_status" value="停用" class="hidden peer">
                            <div class="peer-checked:bg-red-50 peer-checked:border-red-500 peer-checked:text-red-700 dark:peer-checked:bg-red-900/20 dark:peer-checked:border-red-500 dark:peer-checked:text-red-400 border border-gray-300 dark:border-gray-600 rounded-xl py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400 transition min-h-[48px] flex items-center justify-center">
                                <i class="fas fa-circle-xmark mr-1.5"></i>停用
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 原資料 -->
                <div class="pb-3 border-b border-gray-200 dark:border-gray-700">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3">原資料</p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">原店家 <span class="text-red-500">*</span></label>
                            <input type="text" name="old_store" required maxlength="30" placeholder="請輸入原店家名稱"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">原藝名 <span class="text-red-500">*</span></label>
                            <input type="text" name="old_stage_name" required maxlength="20" placeholder="請輸入原藝名"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">原經紀人 <span class="text-red-500">*</span></label>
                            <input type="text" name="old_manager" required maxlength="20" placeholder="請輸入原經紀人姓名"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                    </div>
                </div>

                <!-- 新資料 -->
                <div class="pb-3 border-b border-gray-200 dark:border-gray-700">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3">新資料</p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">新店家 <span class="text-red-500">*</span></label>
                            <input type="text" name="new_store" required maxlength="30" placeholder="請輸入新店家名稱"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">新藝名 <span class="text-red-500">*</span></label>
                            <input type="text" name="new_stage_name" required maxlength="20" placeholder="請輸入新藝名"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">新經紀人 <span class="text-red-500">*</span></label>
                            <input type="text" name="new_manager" required maxlength="20" placeholder="請輸入新經紀人姓名"
                                class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                            <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">狀況 <span class="text-red-500">*</span></label>
                    <input type="text" name="status" required maxlength="50" placeholder="請填寫異動狀況，例如：白紙"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition min-h-[48px]">
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">備註 <span class="text-red-500">*</span></label>
                    <textarea name="note" required maxlength="200" rows="3" placeholder="請填寫備註事項"
                        class="form-input w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition resize-none"></textarea>
                    <p class="field-error text-red-500 text-xs mt-1 hidden"></p>
                </div>

                <div class="pt-3">
                    <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3.5 px-6 rounded-xl transition min-h-[52px] text-base shadow-lg active:scale-[0.98]">
                        確認送出
                    </button>
                </div>
            </form>

            <!-- 送出成功 -->
            <div id="success-msg" class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 text-center">
                <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-2xl text-green-600 dark:text-green-400"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-2">資料已送出</h2>
                <p class="text-gray-500 dark:text-gray-400 mb-6">感謝您的填寫，資料已成功送出。</p>
                <button type="button" id="btn-close-liff"
                    class="bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3 px-8 rounded-xl transition min-h-[48px] active:scale-[0.98]">
                    關閉
                </button>
            </div>
        </div>
    </div>

<script>
(function() {
    const LIFF_ID = '{{ liff_id }}';
    let lineUserId = null;

    // ===== LIFF 初始化 =====
    async function initLiff() {
        try {
            await liff.init({ liffId: LIFF_ID });

            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }

            const profile = await liff.getProfile();
            lineUserId = profile.userId;

            // 顯示用戶資訊
            const avatar = document.getElementById('user-avatar');
            const name = document.getElementById('user-name');
            if (profile.pictureUrl) {
                avatar.src = profile.pictureUrl;
                avatar.classList.remove('hidden');
            }
            name.textContent = profile.displayName;

            // 隱藏載入、顯示主內容
            document.getElementById('loading-section').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        } catch (err) {
            console.error('LIFF init error:', err);
            // 非 LIFF 環境也顯示表單（方便開發測試）
            document.getElementById('loading-section').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        }
    }

    initLiff();

    // ===== Tab 切換 =====
    const tabMap = { pr: 'form-pr', agent: 'form-agent', transfer: 'form-transfer' };

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'text-indigo-600', 'dark:text-indigo-400');
                b.classList.add('text-gray-400', 'dark:text-gray-500');
            });
            this.classList.add('active', 'text-indigo-600', 'dark:text-indigo-400');
            this.classList.remove('text-gray-400', 'dark:text-gray-500');

            document.querySelectorAll('.tab-content').forEach(f => f.classList.add('hidden'));
            document.getElementById(tabMap[this.dataset.tab]).classList.remove('hidden');
            clearAllErrors();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });

    // ===== 驗證 =====
    function validateTWID(id) {
        if (!id) return '請輸入身分證字號';
        id = id.toUpperCase();
        if (!/^[A-Z][12]\d{8}$/.test(id)) return '格式錯誤：需 1 個英文字母 + 9 位數字，第二碼為 1 或 2';
        const m = {A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:34,J:18,K:19,L:20,M:21,N:22,O:35,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,W:32,X:30,Y:31,Z:33};
        const n1 = m[id[0]];
        let sum = Math.floor(n1/10) + (n1%10)*9;
        for (let i=1; i<9; i++) sum += parseInt(id[i])*(8-i+1);
        sum += parseInt(id[9]);
        if (sum % 10 !== 0) return '身分證字號檢查碼錯誤，請確認是否輸入正確';
        return '';
    }

    function validateBirthROC(val) {
        if (!val) return '請輸入出生日期';
        if (!/^\d{2,3}\/\d{2}\/\d{2}$/.test(val)) return '格式錯誤：請輸入 民國年/月/日，例如 85/06/15';
        const p = val.split('/');
        const y = parseInt(p[0]), mo = parseInt(p[1]), d = parseInt(p[2]);
        if (y < 1 || y > 115) return '民國年份範圍不合理';
        if (mo < 1 || mo > 12) return '月份應為 01 ~ 12';
        if (d < 1 || d > 31) return '日期應為 01 ~ 31';
        return '';
    }

    function validateRequired(val, label) {
        if (!val || !val.trim()) return '請輸入' + label;
        return '';
    }

    function showError(input, msg) {
        const el = input.closest('div').querySelector('.field-error');
        if (el) { el.textContent = msg; el.classList.remove('hidden'); }
        input.classList.add('border-red-500','dark:border-red-500');
        input.classList.remove('border-gray-300','dark:border-gray-600');
    }

    function clearError(input) {
        const el = input.closest('div').querySelector('.field-error');
        if (el) { el.textContent = ''; el.classList.add('hidden'); }
        input.classList.remove('border-red-500','dark:border-red-500');
        input.classList.add('border-gray-300','dark:border-gray-600');
    }

    function clearAllErrors() {
        document.querySelectorAll('.field-error').forEach(e => { e.textContent=''; e.classList.add('hidden'); });
        document.querySelectorAll('.form-input').forEach(i => {
            i.classList.remove('border-red-500','dark:border-red-500');
            i.classList.add('border-gray-300','dark:border-gray-600');
        });
    }

    function validateField(input) {
        const name = input.name, val = input.value;
        let err = '';
        if (name === 'id_number') err = validateTWID(val);
        else if (name === 'birth_roc') err = validateBirthROC(val);
        else {
            const lbl = input.closest('div').querySelector('label');
            err = validateRequired(val, lbl ? lbl.textContent.replace('*','').trim() : '此欄位');
        }
        if (err) { showError(input, err); return false; }
        clearError(input); return true;
    }

    // 即時驗證
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('blur', function() { validateField(this); });
        input.addEventListener('input', function() { clearError(this); });
    });

    // 身分證自動轉大寫
    document.querySelectorAll('input[name="id_number"]').forEach(input => {
        input.addEventListener('input', function() { this.value = this.value.toUpperCase(); });
    });

    // ===== 送出 =====
    document.querySelectorAll('form.tab-content').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            let valid = true, first = null;
            this.querySelectorAll('.form-input').forEach(input => {
                if (!validateField(input)) { valid = false; if (!first) first = input; }
            });
            if (!valid) { first.focus(); first.scrollIntoView({ behavior:'smooth', block:'center' }); return; }

            const data = {};
            new FormData(this).forEach((v,k) => { data[k] = v; });
            if (lineUserId) data.line_user_id = lineUserId;
            console.log('送出資料：', data);

            // TODO: 串接 API 送出資料
            // await fetch('/api/info-form', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });

            // 顯示成功畫面
            document.querySelectorAll('.tab-content').forEach(f => f.classList.add('hidden'));
            document.getElementById('warning-block').classList.add('hidden');
            document.getElementById('tab-bar').classList.add('hidden');
            document.getElementById('success-msg').classList.remove('hidden');
        });
    });

    // 關閉按鈕
    document.getElementById('btn-close-liff').addEventListener('click', function() {
        if (liff.isInClient()) {
            liff.closeWindow();
        } else {
            location.reload();
        }
    });
})();
</script>
</body>
</html>