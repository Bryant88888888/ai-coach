{% extends "base.html" %}

{% block title %}排班設定 - 寶格教育訓練{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2">
        <a href="/dashboard/duty" class="hover:text-indigo-600 dark:hover:text-indigo-400">值日生管理</a>
        <i class="fas fa-chevron-right text-xs"></i>
        <span>排班設定</span>
    </div>
    <h1 class="text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white">排班設定</h1>
    <p class="text-gray-600 dark:text-gray-400 mt-1">設定值日生排班規則與任務</p>
</div>

{% if success_message %}
<div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded-xl mb-6 flex items-center">
    <i class="fas fa-check-circle mr-3 text-xl"></i>
    <span>{{ success_message }}</span>
</div>
{% endif %}

{% if error_message %}
<div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded-xl mb-6 flex items-center">
    <i class="fas fa-exclamation-circle mr-3 text-xl"></i>
    <span>{{ error_message }}</span>
</div>
{% endif %}

<!-- 新增設定 -->
{% if not config %}
<div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
        <i class="fas fa-plus-circle text-indigo-500 mr-2"></i>建立排班設定
    </h2>
    <form method="POST" action="/dashboard/duty/config" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    設定名稱 <span class="text-red-500">*</span>
                </label>
                <input type="text" name="name" required value="清潔值日"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    每日值日人數
                </label>
                <input type="number" name="members_per_day" value="1" min="1" max="10"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                提醒時間
            </label>
            <input type="time" name="notify_time" value="08:00"
                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                任務清單（每行一項）
            </label>
            <textarea name="tasks" rows="5" placeholder="掃地拖地&#10;倒垃圾&#10;整理桌面&#10;擦拭玻璃"
                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-lg transition min-h-[44px]">
            <i class="fas fa-save mr-2"></i>建立設定
        </button>
    </form>
</div>
{% else %}
<!-- 編輯設定 -->
<div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white">
            <i class="fas fa-cog text-indigo-500 mr-2"></i>{{ config.name }}
        </h2>
        <span class="px-3 py-1 rounded-full text-sm font-medium
            {% if config.is_active %}bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400
            {% else %}bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400{% endif %}">
            {% if config.is_active %}啟用中{% else %}已停用{% endif %}
        </span>
    </div>
    <form method="POST" action="/dashboard/duty/config/{{ config.id }}" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    設定名稱 <span class="text-red-500">*</span>
                </label>
                <input type="text" name="name" required value="{{ config.name }}"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    每日值日人數
                </label>
                <input type="number" name="members_per_day" value="{{ config.members_per_day }}" min="1" max="10"
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                提醒時間
            </label>
            <input type="time" name="notify_time" value="{{ config.notify_time }}"
                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 min-h-[44px]">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                任務清單（每行一項）
            </label>
            <textarea name="tasks" rows="5"
                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500">{% for task in config.get_tasks() %}{{ task }}{% if not loop.last %}
{% endif %}{% endfor %}</textarea>
        </div>
        <div class="flex items-center gap-4">
            <label class="flex items-center cursor-pointer">
                <input type="checkbox" name="is_active" {% if config.is_active %}checked{% endif %}
                       class="w-4 h-4 text-indigo-600 rounded">
                <span class="ml-2 text-gray-700 dark:text-gray-300">啟用此設定</span>
            </label>
        </div>
        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-lg transition min-h-[44px]">
            <i class="fas fa-save mr-2"></i>儲存設定
        </button>
    </form>
</div>
{% endif %}

<!-- 說明 -->
<div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-4">
    <h3 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">
        <i class="fas fa-lightbulb mr-2"></i>排班設定說明
    </h3>
    <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1 list-disc list-inside">
        <li>每日值日人數：自動排班時每天安排的值日生數量</li>
        <li>提醒時間：系統在此時間透過 LINE 提醒當日值日生</li>
        <li>任務清單：值日生回報時需要勾選的任務項目</li>
    </ul>
</div>
{% endblock %}
